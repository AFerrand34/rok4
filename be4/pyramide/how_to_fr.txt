ETAPE 1 : PREPARATION DES FICHIERS NECESSAIRES A LA PYRAMIDE

Lancer : 
"prepare_pyramide.pl -p produit [-f -a resolution_x_source -y resolution_y_source -w taille_pix_x_source -h taille_pix_x_source] -i images_source [-m masques_metadonnees] -r path/repertoire_pyramide -c compression_images_pyramide -s systeme_coordonnees -t path/repertoire_fichiers_dallage -n annee [-d departement] -x taille_dalles_pixels"

produit :
        ortho
        parcellaire
        scan
        franceraster

-f (optionnel) : pour utiliser la nomenclature standard des produits IGN
        -a resolution en X ; -y resolution en Y en UNITES DU SRS des images SOURCE si -f est defini, sinon aucun effet
        -w taille pixels en X ; -h taille pixels en Y des images SOURCE si -f est defini, sinon aucun effet

images_source : un repertoire d'images ou un fichiers de dalles source issu d'un calcul precedent

masques_metadonnees (optionnel) : un repertoire de mtd ou un fichiers de mtd source issu d'un calcul precedent 

compression images pyramide :
		raw
		jpeg
		png

systeme_coordonnees :
        code RIG de la pyramide a creer : LAMB93 LAMBE WGS84 ...

annee :
        scan25 et scan50 :
                2009-04
        autres :
                2009

le parametre -p contient le nom du produit (voir exemples ci-dessus)
le parametre -f indique si on veut utiliser la nomenclature standard des produits IGN (fonction du produit)
le parametre -a indique la resolution en x des dalles source
le parametre -y indique la resolution en x des dalles source
le parametre -w indique la taille en pixels en x des dalles source
le parametre -h indique la taille en pixels en x des dalles source
le parametre -i contient le chemin des images a integrer dans le cache
le parametre -m (optionnel) contient le chemin des masques de metadonnees associees aux images a integrer au cache (s'il existe)
le parametre -r contient le chemin du repertoire ou creer la nouvelle pyramide (elle sera creee dans un sous-repertoire avec une arborescence specifique)
le parametre -c contient la compression des images de la pyramide finale (voir exemples ci-dessus)
le parametre -s contient le code RIG des images de la pyramide a creer (voir exemples ci-dessus)
le parametre -t contient le chemin du repertoire ou mettre les fichiers de dallage necessaire au calcul de la pyramide (independant du chemin de la pyramide)
le parametre -n contient l'annee de production des donnees
le parametre -d contient le nom du departement cocnerne (le cas echeant)
le parametre -x contient la taille en pixels des dalles du cache

Exemple : 
"prepare_pyramide.pl -p ortho -i /mnt/bdortho/TIF-RVB-0M50-L93/BDO_RVB_0M50_TIF_LAMB93_D75-ED08 -r /home/charlotte/rep_pyramide -c jpeg -s LAMB93 -t /home/charlotte/rep_fichiers_pyramide -n 2008 -d 75 -x 4096"




ETAPE 2 : INITIALISATION DE LA NOUVELLE PYRAMIDE AVEC LES DONNEES DE LA PYRAMIDE PRECEDENTE

Lancer :
"initialise_pyramide.pl -l path/fichier_layer.lay -p path/fichier_pyramide.pyr"

le parametre -l contient le chemin vers le fichier layer actuel du serveur (exemple ORTHO.lay)
le parametre -p contient le chemin vers le fichier de pyramide cree par prepare_pyramide.pl (indique a la fin du traitement)

Exemple :
"initialise_pyramide.pl -l ../config/layers/ORTHO.lay -p /home/charlotte/rep_pyramide/ORTHO_IGNF_LAMB93_2008_75/ORTHO_IGNF_LAMB93_2008_75.pyr"




ETAPE 3 : CREATION DE SCRIPTS DE CALCUL DU CACHE PROPREMENT DIT

Lancer :
"calcule_pyramide.pl -p produit -f path/fichier_dalles_source [-m path/fichier_mtd_source] -s systeme_coordonnees_source -x path/fichier_pyramide.pyr -d %_dilatation_dalles_base -r %_dilatation_reproj -n path/nom_script -t taille_dalles_pixels -j nombre_jobs_min [-k localisation_serveur_rok4 -l nom_layer_a_utiliser]"

produit :
 		ortho
		parcellaire
		scan[25|50|100|dep|reg|1000]
		franceraster

systeme_coordonnees_source :
		code RIG des images source : LAMB93 LAMBE ...

pourcentage_dilatation : 0 a 100
%_dilatation_dalles_base : dilatation des dalles du cache pour trouver les dalles source en recouvrement
%_dilatation_reproj : dilatation des dalles du cache reprojetees pour parer a la deformation de la reprojection

localisation du serveur rok4 : ex obernai.ign.fr/rok4/bin/rok4

layer a utiliser : pour les requetes WMS : ex ORTHO_RAW
	
le parametre -p contient le nom du produit (voir exemple ci-dessus)
le parametre -f contient le chemin vers le fichier des dalles sources produit par prepare_pyramide.pl (indique en cours de traitement)
le parametre -m (optionnel) contient le chemin vers le fichier des metadonnees sources produit par prepare_pyramide.pl (indique en cours de traitement si le parametre -m a ete specifie dans prepare_pyramide.pl)
le parametre -s contient le code RIG des donnees source (voir exemples ci-dessus)
le parametre -x contient le chemin vers le fichier de pyramide cree par prepare_pyramide.pl (indique en fin de traitement)
le parametre -d contient un nombre entre 0 et 100 correspondant au pourcentage de dilatation applique aux dalles cache pour trouver les dalles source en recouvrement
le parametre -r contient un nombre entre 0 et 100 correspondant au pourcentage de dilatation applique aux dalles cache reprojetees pour parer a la deformation due a la reprojection
le parametre -n contient le chemin vers le script a creer (contenant les commandes pour creer le cache)
le parametre -t contient la taille des images du cache en pixels
le parametre -j contient le nombre de jobs minimum crees par le programme
le parametre -k (optionnel) contient la localisation du serveur ROK4 (obligatoire en cas de compression avec perte ou de reprojection)
le parametre -l (optionnel) contient le nom du LAYER du serveur WMS sur lequel on doit faire les requetes (obligatoire en cas de compression avec perte ou de reprojection)

Exemple :
"calcule_pyramide.pl -p ortho -f /home/charlotte/rep_fichiers_pyramide/dalles_source_image.txt -s IGNF:LAMBE -x /home/charlotte/rep_pyramide/ORTHO_IGNF_LAMB93_2008_75/ORTHO_IGNF_LAMB93_2008_75.pyr -d 10 -r 20 -n /home/charlotte/script_pyramide -t 4096 -j 16 -k obernai.ign.fr/rok4/bin/rok4 -l ORTHO_RAW"




ETAPE 4 : METTRE A JOUR LA CONFIGURATION DU SERVEUR

Lancer :
"maj_conf_serveur.pl -l path/fichier_layer.lay -p path/fichier_pyramide.pyr"

le parametre -l contient le chemin vers le fichiers layer a mettre a jour
le parametre -p contient le chemin vers le fichier de pyramide cree par prepare_pyramide.pl (indique a la fin du traitement)

Remarque : ce sont les memes parametres (et les memes contenus) que pour l'etape 2

Exemple :
"maj_conf_serveur.pl -l ../config/layers/ORTHO.lay -p /home/charlotte/rep_pyramide/ORTHO_IGNF_LAMB93_2008_75/ORTHO_IGNF_LAMB93_2008_75.pyr"




ETAPE 5 : METTRE LA PYRAMIDE EN LECTURE SEULE

Lancer :
"pyramide_lecture_seule.pl -p path/fichier_pyramide.pyr"

le parametre -p contient le chemin vers le fichier de pyramide cree par prepare_pyramide.pl (indique a la fin du traitement)

Exemple :
"pyramide_lecture_seule.pl -p /home/charlotte/rep_pyramide/ORTHO_IGNF_LAMB93_2008_75/ORTHO_IGNF_LAMB93_2008_75.pyr"
